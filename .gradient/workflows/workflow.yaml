'on':
  github:
    branches:
      only: main
jobs:
  CloneRepo:
    resources:
      instance-type: P4000
    outputs:
      repo:
        type: volume
    uses: git-checkout@v1
    with:
      url: context.event.github.url
  HelloWorld:
    resources:
      instance-type: P4000
    needs:
      - CloneRepo
    inputs:
      repo: CloneRepo.outputs.repo
    outputs:
      repo:
        type: volume
    uses: script@v1
    with:
      script: |-
        echo "当前目录：$(pwd)"
        ls -ld .                     # cwd 权限
        ls -ld /inputs/repo          # 只读
        ls -ld /outputs              # /outputs 本身
        ls -ld /outputs/repo         # /outputs 本身
        ls -la /outputs              # /outputs 下到底有什么卷
        
        # 测试写文件/文件夹
        echo testing > ./test.txt    && echo "✅ cwd 可写" || echo "❌ cwd 不可写"
        echo testing > /inputs/repo/test.txt \
                                      && echo "✅ /inputs/repo 可写" \
                                      || echo "❌ /inputs/repo 不可写"
        echo testing > /outputs/repo/x.txt \
                                      && echo "✅ /outputs/repo 可写" \
                                      || echo "❌ /outputs/repo 不可写"

      image: paperspace/gradient-base:pt112-tf29-jax0317-py39-20230125
